{% extends "skeleton.html" %}

{% block head %}
{{ super() }}
    <title>{{ _("Non-conformité") }}</title>
    <link href="{{ url_for('static', filename='vendor/css/bootstrap-datepicker3.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='vendor/css/select2.min.css') }}" rel="stylesheet" />
    <script type="text/javascript" src="{{ url_for('static', filename='vendor/js/select2.min.js') }}"></script>
{% endblock %}

{% block content %}
<div id="content">
    <div class="inner">
        <div id="main" style="opacity: 1;">
            <h2 class="page-title page-title-{{ session['user_role']|safe }}"><span>{{ _("Non-conformité") }}</span></h2>
            <form autocomplete="off">
                <div class="form-group row mt-3">
                    <label for="name" class="col-form-label col-3 text-right mt-2">{{ _("Nom de la non-conformité") }} *</label>
                    <div>					
                        <input type="text" name="name" id="name" value="{{ args['details']['name'] }}" class="form-control">			
                    </div>
                </div> 
                <div class="form-group row">
                    <label for="search_reporter" class="col-form-label col-3 text-right mr-1">{{ _("Rapporteur") }} *</label>
                    <div>
                        {% if args['id_det'] == 0 %}
                        <select id="search_reporter" style="width:400px"></select>
                        {% else %}
                        <span class="ml-2">{{ args['details']['reporter'] }}</span>
                        <input type="hidden" id="reporter_id" value="{{ args['details']['reporter_id'] }}">
                        {% endif %}
                    </div>
                </div>

                <fieldset class="border p-2">
                    <legend class="w-auto legend-lbk">{{ _("DECLARATION DE LA NON-CONFORMITE") }}</legend>
                    <div class="form-group row">
                        <label for="report_date" class="col-form-label col-3 text-right mt-2">{{ _("Date") }}</label>
                        <div>					
                            <input id="report_date" name="report_date" class="form-control" type="date" maxlength="10" size="10" value="{{ args['details']['date_create'] }}" style="color: #888;">
                        </div>
                    </div>

                    <!-- PREANA category -->
                    <span class="offset-2 font-info">{{ _("Catégorie de la non-conformité") }}</span>

                    <div class="form-group row">
                        <label for="cat_preana" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Pré analytique") }}</label>
                        <div class="form-inline">
                            <input id="cat_preana" name="cat_preana" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- preana SUB category -->
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Prescription") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat1" name="sub_preana_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Oubli ou examen erroné") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat2" name="sub_preana_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Dossier du patient / identité patient") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat3" name="sub_preana_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Prélèvement") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat4" name="sub_preana_cat4" type="checkbox" value="4" onchange="sub_cat_change(this);">
                        </div>
                    </div>

                    <!-- SUB category from sub_preana_cat4 -->
                    <div class="form-group row mt-n4 sub_sub_preana_cat4 d-none">
                        <label for="sub1_sub_preana_cat4" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Heure de prélèvement") }}</label>
                        <div class="form-inline">
                            <input id="sub1_sub_preana_cat4" name="sub1_sub_preana_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_sub_preana_cat4 d-none">
                        <label for="sub2_preana_cat4" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Volume de prélèvement") }}</label>
                        <div class="form-inline">
                            <input id="sub2_sub_preana_cat4" name="sub2_sub_preana_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_sub_preana_cat4 d-none">
                        <label for="sub3_sub_preana_cat4" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Identification du prélèvement") }}</label>
                        <div class="form-inline">
                            <input id="sub3_sub_preana_cat4" name="sub3_sub_preana_cat4" type="checkbox" value="4">
                        </div>
                    </div>

                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Renseignement clinique") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat5" name="sub_preana_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Transport de l'échantillon") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat6" name="sub_preana_cat6" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat7" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Respect procédures") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat7" name="sub_preana_cat7" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat8" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Urgence") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat8" name="sub_preana_ca8" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat9" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Traçabilité") }}</label>
                        <div class="form-inline">
                            <input id="sub_preana_cat9" name="sub_preana_cat9" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_preana d-none">
                        <label for="sub_preana_cat10" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_preana_cat10" name="sub_preana_cat10" rows="4" cols="50" class="form-control">{{ args['details']['sub_preana_cat10'] }}</textarea>
                        </div>
                    </div>

                    <!-- ANALY category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_analy" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Analytique") }}</label>
                        <div class="form-inline">
                            <input id="cat_analy" name="cat_analy" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- ANALY SUB category -->
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Conservation échantillon avant analyse") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat1" name="sub_analy_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Urgence") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat2" name="sub_analy_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Centrifugation") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat3" name="sub_analy_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Aliquotage") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat4" name="sub_analy_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Contrôle qualité interne") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat5" name="sub_analy_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Contrôle qualité externe") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat6" name="sub_analy_cat6" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat7" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Traçabilité") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat7" name="sub_analy_cat7" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat8" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Respect procédures") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat8" name="sub_analy_cat8" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat9" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Absence de résultats/Résultats aberrants") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat9" name="sub_analy_cat9" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat10" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Critère de repasse non respecté") }}</label>
                        <div class="form-inline">
                            <input id="sub_analy_cat10" name="sub_analy_cat10" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_analy d-none">
                        <label for="sub_analy_cat11" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_analy_cat11" name="sub_analy_cat11" rows="4" cols="50" class="form-control">{{ args['details']['sub_analy_cat11'] }}</textarea>
                        </div>
                    </div>

                    <!-- POSTANA category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_postana" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Post analytique") }}</label>
                        <div class="form-inline">
                            <input id="cat_postana" name="cat_postana" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- POSTANA SUB category -->
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Dossier non validé") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat1" name="sub_postana_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Validation partielle non / mal réalisée") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat2" name="sub_postana_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Résultat erroné / aberrant") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat3" name="sub_postana_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Absence de résultat") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat4" name="sub_postana_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Erreur de saisie") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat5" name="sub_postana_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Interprétation des résultats") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat6" name="sub_postana_cat6" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat7" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Prestation de conseil") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat7" name="sub_postana_cat7" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat8" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Sérothèque/conservation échantillon après analyse") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat8" name="sub_postana_cat8" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat9" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Respect procédures") }}</label>
                        <div class="form-inline">
                            <input id="sub_postana_cat9" name="sub_postana_cat9" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_postana d-none">
                        <label for="sub_postana_cat10" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_postana_cat10" name="sub_postana_cat10" rows="4" cols="50" class="form-control">{{ args['details']['sub_postana_cat10'] }}</textarea>
                        </div>
                    </div>
                    
                    <!-- RES category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_res" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Transmission des résultats") }}</label>
                        <div class="form-inline">
                            <input id="cat_res" name="cat_res" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- RES SUB category -->
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Défaut/Absence de transmission patient") }}</label>
                        <div class="form-inline">
                            <input id="sub_res_cat1" name="sub_res_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Défaut/Absence de transmission Prescripteur/Correspondant") }}</label>
                        <div class="form-inline">
                            <input id="sub_res_cat2" name="sub_res_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Accès aux résultats") }}</label>
                        <div class="form-inline">
                            <input id="sub_res_cat3" name="sub_res_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Date de rendu erronée") }}</label>
                        <div class="form-inline">
                            <input id="sub_res_cat4" name="sub_res_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Délai de transmission non respecté") }}</label>
                        <div class="form-inline">
                            <input id="sub_res_cat5" name="sub_res_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Non respect de la procédure de rendu des résultats") }}</label>
                        <div class="form-inline">
                            <input id="sub_res_cat6" name="sub_res_cat6" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_res d-none">
                        <label for="sub_res_cat7" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_res_cat7" name="sub_res_cat7" rows="4" cols="50" class="form-control">{{ args['details']['sub_res_cat7'] }}</textarea>
                        </div>
                    </div>

                    <!--HR category  -->
                    <div class="form-group row mt-n4">
                        <label for="cat_hr" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Ressources humaines") }}</label>
                        <div class="form-inline">
                            <input id="cat_hr" name="cat_hr" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- HR SUB category -->
                    <div class="form-group row mt-n4 sub_hr d-none">
                        <label for="sub_hr_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Non respect procédure") }}</label>
                        <div class="form-inline">
                            <input id="sub_hr_cat1" name="sub_hr_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_hr d-none">
                        <label for="sub_hr_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Absence") }}</label>
                        <div class="form-inline">
                            <input id="sub_hr_cat2" name="sub_hr_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_hr d-none">
                        <label for="sub_hr_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Habilitation/maintien des compétences") }}</label>
                        <div class="form-inline">
                            <input id="sub_hr_cat3" name="sub_hr_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_hr d-none">
                        <label for="sub_hr_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Accident exposition au sang / Hygiène et sécurité") }}</label>
                        <div class="form-inline">
                            <input id="sub_hr_cat4" name="sub_hr_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_hr d-none">
                        <label for="sub_hr_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_hr_cat5" name="sub_hr_cat5" rows="4" cols="50" class="form-control">{{ args['details']['sub_hr_cat5'] }}</textarea>
                        </div>
                    </div>

                    <!-- EQUIPMENT category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_eqp" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Equipements") }}</label>
                        <div class="form-inline">
                            <input id="cat_eqp" name="cat_eqp" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- EQUIPMENT SUB category -->
                    <div class="form-group row mt-n4 sub_eqp d-none">
                        <label for="sub_eqp_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Etalonnage, Certification, Calibrage") }}</label>
                        <div class="form-inline">
                            <input id="sub_eqp_cat1" name="sub_eqp_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_eqp d-none">
                        <label for="sub_eqp_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Calibration automate") }}</label>
                        <div class="form-inline">
                            <input id="sub_eqp_cat2" name="sub_eqp_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_eqp d-none">
                        <label for="sub_eqp_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Alarme") }}</label>
                        <div class="form-inline">
                            <input id="sub_eqp_cat3" name="sub_eqp_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_eqp d-none">
                        <label for="sub_eqp_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Panne d'un équipement") }}</label>
                        <div class="form-inline">
                            <input id="sub_eqp_cat4" name="sub_eqp_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_eqp d-none">
                        <label for="sub_eqp_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Respect procédure") }}</label>
                        <div class="form-inline">
                            <input id="sub_eqp_cat5" name="sub_eqp_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_eqp d-none">
                        <label for="sub_eqp_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_eqp_cat6" name="sub_eqp_cat6" rows="4" cols="50" class="form-control">{{ args['details']['sub_eqp_cat6'] }}</textarea>
                        </div>
                    </div>
                    <div class="form-group row row sub_eqp d-none">
                        <label for="search_eqp" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Equipement") }}</label>
                        <div>
                            <select id="search_eqp" style="width:400px"></select><br />
                            <span class="ml-2">{{ args['details']['equipment'] }}</span>
                        </div>
                    </div>

                    <!-- CONSUMABLE category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_consu" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Réactifs et consommables") }}</label>
                        <div class="form-inline">
                            <input id="cat_consu" name="cat_consu" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- CONSUMABLE SUB category -->
                    <div class="form-group row mt-n4 sub_consu d-none">
                        <label for="sub_consu_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Réception de réactifs et/ou consommables ne correspondant pas à la commande") }}</label>
                        <div class="form-inline">
                            <input id="sub_consu_cat1" name="sub_consu_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_consu d-none">
                        <label for="sub_consu_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Délai livraison") }}</label>
                        <div class="form-inline">
                            <input id="sub_consu_cat2" name="sub_consu_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_consu d-none">
                        <label for="sub_consu_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Réactifs périmés") }}</label>
                        <div class="form-inline">
                            <input id="sub_consu_cat3" name="sub_consu_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_consu d-none">
                        <label for="sub_consu_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Rupture de stock (cf nom du fournisseur)") }}</label>
                        <div class="form-inline">
                            <input id="sub_consu_cat4" name="sub_consu_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_consu d-none">
                        <label for="sub_consu_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Déstockage produits non conforme") }}</label>
                        <div class="form-inline">
                            <input id="sub_consu_cat5" name="sub_consu_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_consu d-none">
                        <label for="sub_consu_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_consu_cat6" name="sub_consu_cat6" rows="4" cols="50" class="form-control">{{ args['details']['sub_consu_cat6'] }}</textarea>
                        </div>
                    </div>
                    <div class="form-group row sub_consu d-none">
                        <label for="search_supplier" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Fournisseur") }}</label>
                        <div>
                            <select id="search_supplier" style="width:400px"></select><br />
                            <span class="ml-2">{{ args['details']['supplier'] }}</span>
                        </div>
                    </div>

                    <!-- LOCAL category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_local" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Locaux et environnement") }}</label>
                        <div class="form-inline">
                            <input id="cat_local" name="cat_local" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- LOCAL SUB category -->
                    <div class="form-group row mt-n4 sub_local d-none">
                        <label for="sub_local_cat1" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Nettoyage du laboratoire") }}</label>
                        <div class="form-inline">
                            <input id="sub_local_cat1" name="sub_local_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_local d-none">
                        <label for="sub_local_cat2" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Entretien du batiment") }}</label>
                        <div class="form-inline">
                            <input id="sub_local_cat2" name="sub_local_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_local d-none">
                        <label for="sub_local_cat3" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Coupure d'électricité") }}</label>
                        <div class="form-inline">
                            <input id="sub_local_cat3" name="sub_local_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_local d-none">
                        <label for="sub_local_cat4" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Coupure d'eau") }}</label>
                        <div class="form-inline">
                            <input id="sub_local_cat4" name="sub_local_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_local d-none">
                        <label for="sub_local_cat5" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Gestion des déchets") }}</label>
                        <div class="form-inline">
                            <input id="sub_local_cat5" name="sub_local_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_local d-none">
                        <label for="sub_local_cat6" class="col-form-label col-4 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_local_cat6" name="sub_local_cat6" rows="4" cols="50" class="form-control">{{ args['details']['sub_local_cat6'] }}</textarea>
                        </div>
                    </div>

                    <!-- SI category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_si" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Systèmes informatiques") }}</label>
                        <div class="form-inline">
                            <input id="cat_si" name="cat_si" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- SI SUB category -->
                    <div class="form-group row mt-n4 sub_si d-none">
                        <label for="sub_si_cat1" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Abscence de connexion") }}</label>
                        <div class="form-inline">
                            <input id="sub_si_cat1" name="sub_si_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_si d-none">
                        <label for="sub_si_cat2" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Errer de paramétrage") }}</label>
                        <div class="form-inline">
                            <input id="sub_si_cat2" name="sub_si_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_si d-none">
                        <label for="sub_si_cat3" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Panne réseau") }}</label>
                        <div class="form-inline">
                            <input id="sub_si_cat3" name="sub_si_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_si d-none">
                        <label for="sub_si_cat4" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Panne système d'information") }}</label>
                        <div class="form-inline">
                            <input id="sub_si_cat4" name="sub_si_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_si d-none">
                        <label for="sub_si_cat5" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Pannes matériel informatique") }}</label>
                        <div class="form-inline">
                            <input id="sub_si_cat5" name="sub_si_cat5" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_si d-none">
                        <label for="sub_si_cat6" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_si_cat6" name="sub_si_cat6" rows="4" cols="50" class="form-control">{{ args['details']['sub_si_cat6'] }}</textarea>
                        </div>
                    </div>

                    <!-- CONTRACT category -->
                    <div class="form-group row mt-n4">
                        <label for="cat_contract" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Sous-traitance") }}</label>
                        <div class="form-inline">
                            <input id="cat_contract" name="cat_contract" type="checkbox" value="4" onchange="cat_change(this);">
                        </div>
                    </div>

                    <!-- CONTRACT SUB category -->
                    <div class="form-group row mt-n4 sub_contract d-none">
                        <label for="sub_contract_cat1" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Délai de rendu non respecté") }}</label>
                        <div class="form-inline">
                            <input id="sub_contract_cat1" name="sub_contract_cat1" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_contract d-none">
                        <label for="sub_contract_cat2" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Erreur / oubli examen") }}</label>
                        <div class="form-inline">
                            <input id="sub_contract_cat2" name="sub_contract_cat2" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_contract d-none">
                        <label for="sub_contract_cat3" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Mauvaise conservation lors du transport") }}</label>
                        <div class="form-inline">
                            <input id="sub_contract_cat3" name="sub_contract_cat3" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_contract d-none">
                        <label for="sub_contract_cat4" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Problème de facturation") }}</label>
                        <div class="form-inline">
                            <input id="sub_contract_cat4" name="sub_contract_cat4" type="checkbox" value="4">
                        </div>
                    </div>
                    <div class="form-group row mt-n4 sub_contract d-none">
                        <label for="sub_contract_cat5" class="col-form-label col-5 text-right ml-1 mr-2">{{ _("Autres") }}</label>
                        <div class="form-inline">
                            <textarea id="sub_contract_cat5" name="sub_contract_cat5" rows="4" cols="50" class="form-control">{{ args['details']['sub_contract_cat5'] }}</textarea>
                        </div>
                    </div>

                    <!-- CLIENT category -->
                    <div class="form-group row">
                        <label for="cat_client" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Réclamations clients") }}</label>
                        <div class="form-inline">
                            <textarea id="cat_client" name="cat_client" rows="4" cols="50" class="form-control">{{ args['details']['cat_client'] }}</textarea>
                        </div>
                    </div>

                    <!-- OTHER category -->
                    <div class="form-group row">
                        <label for="cat_other" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Autre") }}</label>
                        <div class="form-inline">
                            <textarea id="cat_other" name="cat_other" rows="4" cols="50" class="form-control">{{ args['details']['cat_other'] }}</textarea>
                        </div>
                    </div>
                    
                    <!-- ABOUT PATIENT RECORD ? -->
                    <div class="form-group row">
                        <label class="col-form-label col-3 text-right mt-2">{{ _("Est ce que cette non-conformité concerne un dossier patient ?") }}</label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="about_pat_rec" value="4" onchange="pat_rec_change(this);" id="about_pat_rec_yes">{{ _("Oui") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="about_pat_rec" value="5" onchange="pat_rec_change(this);" checked="checked">{{ _("Non") }}</input>
                        </label>
                    </div>

                    <div class="form-group row d-none" id="group_pat_rec_num">
                        <label for="pat_rec_num" class="col-form-label col-3 text-right ml-1 mr-2">{{ _("Numéro de dossier") }}</label>
                        <div class="form-inline">
                            <input id="pat_rec_num" name="pat_rec" type="text" value="{{ args['details']['pat_rec_num'] }}">
                        </div>
                    </div>


                    <!-- DESCRIPTION -->
                    <div class="form-group row mt-3">
                        <label for="description" class="col-form-label col-3 text-right mt-2">{{ _("Description de la non-conformité") }}</label>
                        <div>					
                            <textarea id="description" name="description" rows="4" cols="50" class="form-control">{{ args['details']['description'] }}</textarea>
                        </div>
                    </div>

                    <!-- PATIENT IMPACT -->
                    <div class="form-group row">
                        <label class="col-form-label col-3 text-right mt-2">{{ _("Impact sur le patient") }}</label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_pat" value="4" {% if args['details']['impact_pat'] == 4 %}checked{% endif %}>{{ _("Faible") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_pat" value="5" {% if args['details']['impact_pat'] == 5 %}checked{% endif %}>{{ _("Important") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_pat" value="6" {% if args['details']['impact_pat'] == 6 %}checked{% endif %}>{{ _("Grave") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_pat" value="7" {% if not args['details'] or args['details']['impact_pat'] == 7 %}checked{% endif %}>{{ _("Aucun") }}</input>
                        </label>
                    </div>

                    <!-- USER IMPACT -->
                    <div class="form-group row">
                        <label class="col-form-label col-3 text-right mt-2">{{ _("Impact sur le personnel/visiteur") }}</label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_user" value="4" {% if args['details']['impact_user'] == 4 %}checked{% endif %}>{{ _("Faible") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_user" value="5" {% if args['details']['impact_user'] == 5 %}checked{% endif %}>{{ _("Important") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_user" value="6" {% if args['details']['impact_user'] == 6 %}checked{% endif %}>{{ _("Grave") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impact_user" value="7" {% if not args['details'] or args['details']['impact_user'] == 7 %}checked{% endif %}>{{ _("Aucun") }}</input>
                        </label>
                    </div>
                </fieldset>

                
                <fieldset class="border p-2">
                    <legend class="w-auto legend-lbk">{{ _("SUIVI DE LA NON-CONFORMITE") }}</legend>
                    <div class="form-group row">
                        <label for="search_followed" class="col-form-label col-3 text-right mr-1">{{ _("Qui") }}</label>
                        <div>
                            <select id="search_followed" style="width:400px" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}></select><br />
                            <span class="ml-2">{{ args['details']['followed'] }}</span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="flwd_what" class="col-form-label col-3 text-right mt-2">{{ _("Quoi") }}</label>
                        <div>					
                            <textarea id="flwd_what" name="flwd_what" rows="4" cols="50" class="form-control" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}>{{ args['details']['flwd_what'] }}</textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="flwd_when" class="col-form-label col-3 text-right mt-2">{{ _("Quand") }}</label>
                        <div>					
                            <input id="flwd_when" name="flwd_when" class="form-control" type="date" maxlength="10" size="10" value="{{ args['details']['flwd_when'] }}" style="color: #888;" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}>
                        </div>
                    </div>

                    <!-- IMPLEMENTATION OF ACTION  -->
                    <div class="form-group row">
                        <label class="col-form-label col-3 text-right mt-2">{{ _("Mise en place d’une action correctrice") }}</label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impl_action" value="4" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %} {% if args['details']['impl_action'] == 4 %}checked{% endif %}>{{ _("Oui") }}</input>
                        </label>
                        <label class="col-form-label text-right mt-2 mr-3">
                            <input type="radio" class="mr-1" name="impl_action" value="5" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %} {% if not args['details'] or args['details']['impl_action'] == 5 %}checked{% endif %}>{{ _("Non") }}</input>
                        </label>
                    </div>

                    <div class="form-group row">
                        <label for="flwd_descr_action" class="col-form-label col-3 text-right mt-2">{{ _("Description de l'action correctrice") }}</label>
                        <div>					
                            <textarea id="flwd_descr_action" name="flwd_descr_action" rows="4" cols="50" class="form-control" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}>{{ args['details']['flwd_descr_action'] }}</textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="flwd_action_date" class="col-form-label col-3 text-right mt-2">{{ _("Date de réalisation de l'action correctrice") }}</label>
                        <div>					
                            <input id="flwd_action_date" name="flwd_action_date" class="form-control" type="date" maxlength="10" size="10" value="{{ args['details']['flwd_action_date'] }}" style="color: #888;" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="search_incharge" class="col-form-label col-3 text-right mr-1">{{ _("Responsable de l'action") }}</label>
                        <div>
                            <select id="search_incharge" style="width:400px" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}></select><br />
                            <span class="ml-2">{{ args['details']['incharge'] }}</span>
                        </div>
                    </div>
                </fieldset>


                <fieldset class="border p-2">
                    <legend class="w-auto legend-lbk">{{ _("CLOTURE DE LA NON-CONFORMITE") }}</legend>
                    <div class="form-group row">
                        <label for="close_comment" class="col-form-label col-3 text-right mt-2">{{ _("Commentaire") }}</label>
                        <div>					
                            <textarea id="close_comment" name="close_comment" rows="4" cols="50" class="form-control" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}>{{ args['details']['close_comment'] }}</textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="search_validate" class="col-form-label col-3 text-right mr-1">{{ _("Validé par") }}</label>
                        <div>
                            <select id="search_validate" style="width:400px" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}></select><br />
                            <span class="ml-2">{{ args['details']['validate'] }}</span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="close_date" class="col-form-label col-3 text-right mt-2">{{ _("Date de clotûre") }}</label>
                        <div>					
                            <input id="close_date" name="close_date" class="form-control" type="date" maxlength="10" size="10" value="{{ args['details']['close_date'] }}" style="color: #888;" {% if session['user_role'] == 'TA' or session['user_role'] == 'T' or session['user_role'] == 'SA' or session['user_role'] == 'S' %}disabled{% endif %}>
                        </div>
                    </div>
                </fieldset>
            </form>
            
            <div class="my-2 clearfix">
                <div class="float-left" style="margin-left:0px;">
                    <input type="button" onclick="cancel();" id="btn_cancel" value="{{ _("Annuler") }}" class="btn btn-{{ session['user_role']|safe }}">
                </div>
                <div class="float-right">
                    <input type="button" onclick="save_item();" id="btn_save" value="{{ _("Enregistrer") }}" class="btn btn-{{ session['user_role']|safe }} ml-2">
                </div>
            </div>
        </div>
    </div>
</div><!-- close content -->
{% endblock %}

{% block add_script %}
<script>
var data_det = {% if args['details'] %}{{ args['details']|safe }}{% else %}[]{% endif %} ;

$("#search_reporter").select2(
{
    placeholder: "{{ _("Cliquer pour commencer une recherche") }}",
    tags: false,
    multiple: false,
    tokenSeparators: [','],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/user/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_reporter").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.field_value,
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_reporter").on("select2:select", function (e) 
{
let id_item = $(e.currentTarget).val();
} ) ;

$("#search_followed").select2(
{
    placeholder: "{{ _("Cliquer pour commencer une recherche") }}",
    tags: false,
    multiple: false,
    tokenSeparators: [','],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/user/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_followed").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.field_value,
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_followed").on("select2:select", function (e) 
{
let id_item = $(e.currentTarget).val();
} ) ;

$("#search_incharge").select2(
{
    placeholder: "{{ _("Cliquer pour commencer une recherche") }}",
    tags: false,
    multiple: false,
    tokenSeparators: [','],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/user/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_incharge").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.field_value,
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_incharge").on("select2:select", function (e) 
{
let id_item = $(e.currentTarget).val();
} ) ;

$("#search_validate").select2(
{
    placeholder: "{{ _("Cliquer pour commencer une recherche") }}",
    tags: false,
    multiple: false,
    tokenSeparators: [','],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/user/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_validate").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.field_value,
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_validate").on("select2:select", function (e) 
{
let id_item = $(e.currentTarget).val();
} ) ;

$("#search_eqp").select2(
{
    placeholder: "{{ _("Cliquer pour commencer une recherche") }}",
    tags: false,
    multiple: false,
    tokenSeparators: [','],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/quality/equipment/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_eqp").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.field_value,
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_eqp").on("select2:select", function (e) 
{
let id_item = $(e.currentTarget).val();
} ) ;

$("#search_supplier").select2(
{
    placeholder: "{{ _("Cliquer pour commencer une recherche") }}",
    tags: false,
    multiple: false,
    tokenSeparators: [','],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/quality/supplier/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_supplier").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.field_value,
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_supplier").on("select2:select", function (e) 
{
let id_item = $(e.currentTarget).val();
} ) ;

function cat_change( elem )
{
let id_elem   = $(elem).attr('id') ;

console.log("DEBUG id_elem="+id_elem);

let class_sub_elem = ".sub_" + id_elem.substr(4) ;

    if ( $(elem).is(':checked') )
    {
    $(class_sub_elem).removeClass('d-none') ;   
    }
    else
    {
    $(class_sub_elem).addClass('d-none') ;
    }

}

function sub_cat_change( elem )
{
let id_elem = $(elem).attr('id') ;

console.log("DEBUG id_elem="+id_elem);

let class_sub_elem = ".sub_" + id_elem ;

    if ( $(elem).is(':checked') )
    {
    $(class_sub_elem).removeClass('d-none') ;   
    }
    else
    {
    $(class_sub_elem).addClass('d-none') ;
    }
}

function pat_rec_change( elem )
{
let val_elem = $(elem).val() ;

console.log("DEBUG val_elem="+val_elem);

    if ( val_elem == "4" )
    {
    $("#group_pat_rec_num").removeClass('d-none') ;   
    }
    else
    {
    $("#pat_rec_num").val("") ;
    $("#group_pat_rec_num").addClass('d-none') ;
    }

}

function save_item()
{
var id_owner   = {{ session['user_id_group']|safe }} ;
var id_details = {{ args['id_det']|safe }}   ;
var name       = $("#name").val()            ;
var reporter   = {% if args['id_det'] > 0 %}$("#reporter_id").val(){% else %}$("#search_reporter").val(){% endif %} ;

/* --- Declaration of non-conformity ---*/
var report_date = $("#report_date").val()     ;

// PREANA category
var cat_preana      = replaceUndefined($("#cat_preana:checked").val())      ;
var sub_preana_cat1 = replaceUndefined($("#sub_preana_cat1:checked").val()) ;
var sub_preana_cat2 = replaceUndefined($("#sub_preana_cat2:checked").val()) ;
var sub_preana_cat3 = replaceUndefined($("#sub_preana_cat3:checked").val()) ;
var sub_preana_cat4 = replaceUndefined($("#sub_preana_cat4:checked").val()) ;
var sub1_sub_preana_cat4 = replaceUndefined($("#sub1_sub_preana_cat4:checked").val()) ;
var sub2_sub_preana_cat4 = replaceUndefined($("#sub2_sub_preana_cat4:checked").val()) ;
var sub3_sub_preana_cat4 = replaceUndefined($("#sub3_sub_preana_cat4:checked").val()) ;
var sub_preana_cat5 = replaceUndefined($("#sub_preana_cat5:checked").val()) ;
var sub_preana_cat6 = replaceUndefined($("#sub_preana_cat6:checked").val()) ;
var sub_preana_cat7 = replaceUndefined($("#sub_preana_cat7:checked").val()) ;
var sub_preana_cat8 = replaceUndefined($("#sub_preana_cat8:checked").val()) ;
var sub_preana_cat9 = replaceUndefined($("#sub_preana_cat9:checked").val()) ;
var sub_preana_cat10= JSON.stringify( $("#sub_preana_cat10").val() ) ;

// ANALY category
var cat_analy      = replaceUndefined($("#cat_analy:checked").val())      ;
var sub_analy_cat1 = replaceUndefined($("#sub_analy_cat1:checked").val()) ;
var sub_analy_cat2 = replaceUndefined($("#sub_analy_cat2:checked").val()) ;
var sub_analy_cat3 = replaceUndefined($("#sub_analy_cat3:checked").val()) ;
var sub_analy_cat4 = replaceUndefined($("#sub_analy_cat4:checked").val()) ;
var sub_analy_cat5 = replaceUndefined($("#sub_analy_cat5:checked").val()) ;
var sub_analy_cat6 = replaceUndefined($("#sub_analy_cat6:checked").val()) ;
var sub_analy_cat7 = replaceUndefined($("#sub_analy_cat7:checked").val()) ;
var sub_analy_cat8 = replaceUndefined($("#sub_analy_cat8:checked").val()) ;
var sub_analy_cat9 = replaceUndefined($("#sub_analy_cat9:checked").val()) ;
var sub_analy_cat10= replaceUndefined($("#sub_analy_cat10:checked").val());
var sub_analy_cat11= JSON.stringify( $("#sub_analy_cat11").val() ) ;

// POSTANA category
var cat_postana      = replaceUndefined($("#cat_postana:checked").val())      ;
var sub_postana_cat1 = replaceUndefined($("#sub_postana_cat1:checked").val()) ;
var sub_postana_cat2 = replaceUndefined($("#sub_postana_cat2:checked").val()) ;
var sub_postana_cat3 = replaceUndefined($("#sub_postana_cat3:checked").val()) ;
var sub_postana_cat4 = replaceUndefined($("#sub_postana_cat4:checked").val()) ;
var sub_postana_cat5 = replaceUndefined($("#sub_postana_cat5:checked").val()) ;
var sub_postana_cat6 = replaceUndefined($("#sub_postana_cat6:checked").val()) ;
var sub_postana_cat7 = replaceUndefined($("#sub_postana_cat7:checked").val()) ;
var sub_postana_cat8 = replaceUndefined($("#sub_postana_cat8:checked").val()) ;
var sub_postana_cat9 = replaceUndefined($("#sub_postana_cat9:checked").val()) ;
var sub_postana_cat10= JSON.stringify( $("#sub_postana_cat10").val() ) ;

// RES category
var cat_res      = replaceUndefined($("#cat_res:checked").val())      ;
var sub_res_cat1 = replaceUndefined($("#sub_res_cat1:checked").val()) ;
var sub_res_cat2 = replaceUndefined($("#sub_res_cat2:checked").val()) ;
var sub_res_cat3 = replaceUndefined($("#sub_res_cat3:checked").val()) ;
var sub_res_cat4 = replaceUndefined($("#sub_res_cat4:checked").val()) ;
var sub_res_cat5 = replaceUndefined($("#sub_res_cat5:checked").val()) ;
var sub_res_cat6 = replaceUndefined($("#sub_res_cat6:checked").val()) ;
var sub_res_cat7 = JSON.stringify( $("#sub_res_cat7").val() ) ;

// HR category
var cat_hr      = replaceUndefined($("#cat_hr:checked").val())      ;
var sub_hr_cat1 = replaceUndefined($("#sub_hr_cat1:checked").val()) ;
var sub_hr_cat2 = replaceUndefined($("#sub_hr_cat2:checked").val()) ;
var sub_hr_cat3 = replaceUndefined($("#sub_hr_cat3:checked").val()) ;
var sub_hr_cat4 = replaceUndefined($("#sub_hr_cat4:checked").val()) ;
var sub_hr_cat5 = JSON.stringify( $("#sub_hr_cat5").val() ) ;

// EQUIPMENT category
var cat_eqp      = replaceUndefined($("#cat_eqp:checked").val())      ;
var sub_eqp_cat1 = replaceUndefined($("#sub_eqp_cat1:checked").val()) ;
var sub_eqp_cat2 = replaceUndefined($("#sub_eqp_cat2:checked").val()) ;
var sub_eqp_cat3 = replaceUndefined($("#sub_eqp_cat3:checked").val()) ;
var sub_eqp_cat4 = replaceUndefined($("#sub_eqp_cat4:checked").val()) ;
var sub_eqp_cat5 = replaceUndefined($("#sub_eqp_cat5:checked").val()) ;
var sub_eqp_cat6 = JSON.stringify( $("#sub_eqp_cat6").val() ) ;
var equipment    = $("#search_eqp").val() ;

// CONSUMABLE category
var cat_consu      = replaceUndefined($("#cat_consu:checked").val())      ;
var sub_consu_cat1 = replaceUndefined($("#sub_consu_cat1:checked").val()) ;
var sub_consu_cat2 = replaceUndefined($("#sub_consu_cat2:checked").val()) ;
var sub_consu_cat3 = replaceUndefined($("#sub_consu_cat3:checked").val()) ;
var sub_consu_cat4 = replaceUndefined($("#sub_consu_cat4:checked").val()) ;
var sub_consu_cat5 = replaceUndefined($("#sub_consu_cat5:checked").val()) ;
var sub_consu_cat6 = JSON.stringify( $("#sub_consu_cat6").val() ) ;
var supplier       = $("#search_supplier").val();

// LOCAL category
var cat_local      = replaceUndefined($("#cat_local:checked").val())      ;
var sub_local_cat1 = replaceUndefined($("#sub_local_cat1:checked").val()) ;
var sub_local_cat2 = replaceUndefined($("#sub_local_cat2:checked").val()) ;
var sub_local_cat3 = replaceUndefined($("#sub_local_cat3:checked").val()) ;
var sub_local_cat4 = replaceUndefined($("#sub_local_cat4:checked").val()) ;
var sub_local_cat5 = replaceUndefined($("#sub_local_cat5:checked").val()) ;
var sub_local_cat6 = JSON.stringify( $("#sub_local_cat6").val() ) ;

// SI category
var cat_si      = replaceUndefined($("#cat_si:checked").val())      ;
var sub_si_cat1 = replaceUndefined($("#sub_si_cat1:checked").val()) ;
var sub_si_cat2 = replaceUndefined($("#sub_si_cat2:checked").val()) ;
var sub_si_cat3 = replaceUndefined($("#sub_si_cat3:checked").val()) ;
var sub_si_cat4 = replaceUndefined($("#sub_si_cat4:checked").val()) ;
var sub_si_cat5 = replaceUndefined($("#sub_si_cat5:checked").val()) ;
var sub_si_cat6 = JSON.stringify( $("#sub_si_cat6").val() ) ;

// CONTRACT category
var cat_contract      = replaceUndefined($("#cat_contract:checked").val())      ;
var sub_contract_cat1 = replaceUndefined($("#sub_contract_cat1:checked").val()) ;
var sub_contract_cat2 = replaceUndefined($("#sub_contract_cat2:checked").val()) ;
var sub_contract_cat3 = replaceUndefined($("#sub_contract_cat3:checked").val()) ;
var sub_contract_cat4 = replaceUndefined($("#sub_contract_cat4:checked").val()) ;
var sub_contract_cat5 = JSON.stringify( $("#sub_contract_cat5").val() ) ;

// CLIENT category
var cat_client = JSON.stringify( $("#cat_client").val() ) ;

// OTHER category
var cat_other = JSON.stringify( $("#cat_other").val() ) ;

var about_pat_rec= $("input:radio[name=about_pat_rec]:checked").val() ;
var pat_rec_num  = $("#pat_rec_num").val()                            ;
var description  = JSON.stringify( $("#description").val() )          ;
var impact_pat   = $("input:radio[name=impact_pat]:checked").val()    ;
var impact_user  = $("input:radio[name=impact_user]:checked").val()   ;

/* --- Follow-up of non-conformity ---*/
var followed          = $("#search_followed").val()             ;
var flwd_what         = JSON.stringify( $("#flwd_what").val() ) ;
var flwd_when         = $("#flwd_when").val()                   ;
var impl_action       = $("input:radio[name=impl_action]:checked").val();
var flwd_descr_action = JSON.stringify( $("#flwd_descr_action").val() ) ;
var flwd_action_date  = $("#flwd_action_date").val() ;
var incharge          = $("#search_incharge").val()  ;

/* --- Closing of non-conformity ---*/
var close_comment = JSON.stringify( $("#close_comment").val() ) ;
var validate      = $("#search_validate").val() ;
var close_date    = $("#close_date").val()      ;

var msg = "" ;

    if (name == "")
    msg += "{{ _("Veuillez saisir un nom à cette non-conformité.") }}\n" ;

    if (id_details == 0 && reporter == 0)
    msg += "{{ _("Veuillez sélectionner un rapporteur.") }}\n" ;

    if (msg != "")
    {
    alert( msg ) ;
    return false ;
    }

    if (id_details > 0)
    {
        if (followed < 1)
        followed = {% if args['details']['followed_id'] %}{{ args['details']['followed_id']|safe }}{% else %}0{% endif %} ;

        if (incharge < 1)
        incharge = {% if args['details']['incharge_id'] %}{{ args['details']['incharge_id']|safe }}{% else %}0{% endif %} ;

        if (validate < 1)
        validate = {% if args['details']['validate_id'] %}{{ args['details']['validate_id']|safe }}{% else %}0{% endif %} ;

        if (equipment < 1)
        equipment = {% if args['details']['equipment_id'] %}{{ args['details']['equipment_id']|safe }}{% else %}0{% endif %} ;

        if (supplier < 1)
        supplier = {% if args['details']['supplier_id'] %}{{ args['details']['supplier_id']|safe }}{% else %}0{% endif %} ;
    }

var param = '{ "id_owner":' + id_owner + ', ' +
              '"id_item":' + id_details + ', ' +
              '"name":"' + name + '", ' +
              '"reporter":' + reporter + ', ' +
              '"report_date":"' + report_date + '", ' +
              '"cat_preana":' + cat_preana + ', ' +
              '"sub_preana_cat1":' + sub_preana_cat1 + ', ' +
              '"sub_preana_cat2":' + sub_preana_cat2 + ', ' +
              '"sub_preana_cat3":' + sub_preana_cat3 + ', ' +
              '"sub_preana_cat4":' + sub_preana_cat4 + ', ' +
              '"sub1_sub_preana_cat4":' + sub1_sub_preana_cat4 + ', ' +
              '"sub2_sub_preana_cat4":' + sub2_sub_preana_cat4 + ', ' +
              '"sub3_sub_preana_cat4":' + sub3_sub_preana_cat4 + ', ' +
              '"sub_preana_cat5":' + sub_preana_cat5 + ', ' +
              '"sub_preana_cat6":' + sub_preana_cat6 + ', ' +
              '"sub_preana_cat7":' + sub_preana_cat7 + ', ' +
              '"sub_preana_cat8":' + sub_preana_cat8 + ', ' +
              '"sub_preana_cat9":' + sub_preana_cat9 + ', ' +
              '"sub_preana_cat10":' + sub_preana_cat10 + ', ' +
              '"cat_analy":' + cat_analy + ', ' +
              '"sub_analy_cat1":' + sub_analy_cat1 + ', ' +
              '"sub_analy_cat2":' + sub_analy_cat2 + ', ' +
              '"sub_analy_cat3":' + sub_analy_cat3 + ', ' +
              '"sub_analy_cat4":' + sub_analy_cat4 + ', ' +
              '"sub_analy_cat5":' + sub_analy_cat5 + ', ' +
              '"sub_analy_cat6":' + sub_analy_cat6 + ', ' +
              '"sub_analy_cat7":' + sub_analy_cat7 + ', ' +
              '"sub_analy_cat8":' + sub_analy_cat8 + ', ' +
              '"sub_analy_cat9":' + sub_analy_cat9 + ', ' +
              '"sub_analy_cat10":' + sub_analy_cat10 + ', ' +
              '"sub_analy_cat11":' + sub_analy_cat11 + ', ' +
              '"cat_postana":' + cat_postana + ', ' +
              '"sub_postana_cat1":' + sub_postana_cat1 + ', ' +
              '"sub_postana_cat2":' + sub_postana_cat2 + ', ' +
              '"sub_postana_cat3":' + sub_postana_cat3 + ', ' +
              '"sub_postana_cat4":' + sub_postana_cat4 + ', ' +
              '"sub_postana_cat5":' + sub_postana_cat5 + ', ' +
              '"sub_postana_cat6":' + sub_postana_cat6 + ', ' +
              '"sub_postana_cat7":' + sub_postana_cat7 + ', ' +
              '"sub_postana_cat8":' + sub_postana_cat8 + ', ' +
              '"sub_postana_cat9":' + sub_postana_cat9 + ', ' +
              '"sub_postana_cat10":' + sub_postana_cat10 + ', ' +
              '"cat_res":' + cat_res + ', ' +
              '"sub_res_cat1":' + sub_res_cat1 + ', ' +
              '"sub_res_cat2":' + sub_res_cat2 + ', ' +
              '"sub_res_cat3":' + sub_res_cat3 + ', ' +
              '"sub_res_cat4":' + sub_res_cat4 + ', ' +
              '"sub_res_cat5":' + sub_res_cat5 + ', ' +
              '"sub_res_cat6":' + sub_res_cat6 + ', ' +
              '"sub_res_cat7":' + sub_res_cat7 + ', ' +
              '"cat_hr":' + cat_hr + ', ' +
              '"sub_hr_cat1":' + sub_hr_cat1 + ', ' +
              '"sub_hr_cat2":' + sub_hr_cat2 + ', ' +
              '"sub_hr_cat3":' + sub_hr_cat3 + ', ' +
              '"sub_hr_cat4":' + sub_hr_cat4 + ', ' +
              '"sub_hr_cat5":' + sub_hr_cat5 + ', ' +
              '"cat_eqp":' + cat_eqp + ', ' +
              '"sub_eqp_cat1":' + sub_eqp_cat1 + ', ' +
              '"sub_eqp_cat2":' + sub_eqp_cat2 + ', ' +
              '"sub_eqp_cat3":' + sub_eqp_cat3 + ', ' +
              '"sub_eqp_cat4":' + sub_eqp_cat4 + ', ' +
              '"sub_eqp_cat5":' + sub_eqp_cat5 + ', ' +
              '"sub_eqp_cat6":' + sub_eqp_cat6 + ', ' +
              '"equipment":' + equipment + ', ' +
              '"cat_consu":' + cat_consu + ', ' +
              '"sub_consu_cat1":' + sub_consu_cat1 + ', ' +
              '"sub_consu_cat2":' + sub_consu_cat2 + ', ' +
              '"sub_consu_cat3":' + sub_consu_cat3 + ', ' +
              '"sub_consu_cat4":' + sub_consu_cat4 + ', ' +
              '"sub_consu_cat5":' + sub_consu_cat5 + ', ' +
              '"sub_consu_cat6":' + sub_consu_cat6 + ', ' +
              '"supplier":' + supplier + ', ' +
              '"cat_local":' + cat_local + ', ' +
              '"sub_local_cat1":' + sub_local_cat1 + ', ' +
              '"sub_local_cat2":' + sub_local_cat2 + ', ' +
              '"sub_local_cat3":' + sub_local_cat3 + ', ' +
              '"sub_local_cat4":' + sub_local_cat4 + ', ' +
              '"sub_local_cat5":' + sub_local_cat5 + ', ' +
              '"sub_local_cat6":' + sub_local_cat6 + ', ' +
              '"cat_si":' + cat_si + ', ' +
              '"sub_si_cat1":' + sub_si_cat1 + ', ' +
              '"sub_si_cat2":' + sub_si_cat2 + ', ' +
              '"sub_si_cat3":' + sub_si_cat3 + ', ' +
              '"sub_si_cat4":' + sub_si_cat4 + ', ' +
              '"sub_si_cat5":' + sub_si_cat5 + ', ' +
              '"sub_si_cat6":' + sub_si_cat6 + ', ' +
              '"cat_contract":' + cat_contract + ', ' +
              '"sub_contract_cat1":' + sub_contract_cat1 + ', ' +
              '"sub_contract_cat2":' + sub_contract_cat2 + ', ' +
              '"sub_contract_cat3":' + sub_contract_cat3 + ', ' +
              '"sub_contract_cat4":' + sub_contract_cat4 + ', ' +
              '"sub_contract_cat5":' + sub_contract_cat5 + ', ' +
              '"cat_client":' + cat_client + ', ' +
              '"cat_other":' + cat_other + ', ' +
              '"about_pat_rec":' + about_pat_rec + ', ' +
              '"pat_rec_num":"' + pat_rec_num + '", ' +
              '"description":' + description + ', ' +
              '"impact_pat":' + impact_pat + ', ' +
              '"impact_user":' + impact_user + ', ' +
              '"followed":' + followed + ', ' +
              '"flwd_what":' + flwd_what + ', ' +
              '"flwd_when":"' + flwd_when + '", ' +
              '"impl_action":' + impl_action + ', ' +
              '"flwd_descr_action":' + flwd_descr_action + ', ' +
              '"flwd_action_date":"' + flwd_action_date + '", ' +
              '"incharge":' + incharge + ', ' +
              '"close_comment":' + close_comment + ', ' +
              '"validate":' + validate + ', ' +
              '"close_date":"' + close_date + '"}' ;

console.log("DEBUG param=" + param) ;

    $.ajax( {
       type: "POST",
       url: "/services/quality/nonconformity/det/" + id_details,
       dataType: 'json',
       contentType: "application/json; charset=utf-8",
       data: param,
       success: function(data)
           {
           console.log("DEBUG data=" + JSON.stringify(data)) ;

           window.history.back() ;
           },
       error: function(data)
           {
           console.log("ERROR POST item det") ;
           alert("{{ _("Une erreur est survenue lors de l'enregistrement") }}") ;
           }
    } ) ;
}

// usefull to deploy sub response if checkbox is checked
function load_data()
{
    // category
    if ( data_det.cat_preana == 4 )   { $("#cat_preana").prop("checked", true)  ; cat_change( $("#cat_preana") ) ; }
    if ( data_det.cat_analy == 4 )    { $("#cat_analy").prop("checked", true)   ; cat_change( $("#cat_analy") ) ; }
    if ( data_det.cat_postana == 4 )  { $("#cat_postana").prop("checked", true) ; cat_change( $("#cat_postana") ) ; }
    if ( data_det.cat_res == 4 )      { $("#cat_res").prop("checked", true)     ; cat_change( $("#cat_res") ) ; }
    if ( data_det.cat_hr == 4 )       { $("#cat_hr").prop("checked", true)      ; cat_change( $("#cat_hr") ) ; }
    if ( data_det.cat_eqp == 4 )      { $("#cat_eqp").prop("checked", true)     ; cat_change( $("#cat_eqp") ) ; }
    if ( data_det.cat_consu == 4 )    { $("#cat_consu").prop("checked", true)   ; cat_change( $("#cat_consu") ) ; }
    if ( data_det.cat_local == 4 )    { $("#cat_local").prop("checked", true)   ; cat_change( $("#cat_local") ) ; }
    if ( data_det.cat_si == 4 )       { $("#cat_si").prop("checked", true)      ; cat_change( $("#cat_si") ) ; }
    if ( data_det.cat_contract == 4 ) { $("#cat_contract").prop("checked", true); cat_change( $("#cat_contract") ) ; }

    if ( data_det.sub_preana_cat1 == 4 ) { $("#sub_preana_cat1").prop("checked", true) ; }
    if ( data_det.sub_preana_cat2 == 4 ) { $("#sub_preana_cat2").prop("checked", true) ; }
    if ( data_det.sub_preana_cat3 == 4 ) { $("#sub_preana_cat3").prop("checked", true) ; }

    // sub category with sub sub cat
    if ( data_det.sub_preana_cat4 == 4 ) { $("#sub_preana_cat4").prop("checked", true) ; sub_cat_change( $("#sub_preana_cat4") ) ; }

    if ( data_det.sub1_sub_preana_cat4 == 4 ) { $("#sub1_sub_preana_cat4").prop("checked", true) ; }
    if ( data_det.sub2_sub_preana_cat4 == 4 ) { $("#sub2_sub_preana_cat4").prop("checked", true) ; }
    if ( data_det.sub3_sub_preana_cat4 == 4 ) { $("#sub3_sub_preana_cat4").prop("checked", true) ; }

    if ( data_det.sub_preana_cat5 == 4 ) { $("#sub_preana_cat5").prop("checked", true) ; }
    if ( data_det.sub_preana_cat6 == 4 ) { $("#sub_preana_cat6").prop("checked", true) ; }
    if ( data_det.sub_preana_cat7 == 4 ) { $("#sub_preana_cat7").prop("checked", true) ; }
    if ( data_det.sub_preana_cat8 == 4 ) { $("#sub_preana_cat8").prop("checked", true) ; }
    if ( data_det.sub_preana_cat9 == 4 ) { $("#sub_preana_cat9").prop("checked", true) ; }

    if ( data_det.sub_analy_cat1 == 4 ) { $("#sub_analy_cat1").prop("checked", true) ; }
    if ( data_det.sub_analy_cat2 == 4 ) { $("#sub_analy_cat2").prop("checked", true) ; }
    if ( data_det.sub_analy_cat3 == 4 ) { $("#sub_analy_cat3").prop("checked", true) ; }
    if ( data_det.sub_analy_cat4 == 4 ) { $("#sub_analy_cat4").prop("checked", true) ; }
    if ( data_det.sub_analy_cat5 == 4 ) { $("#sub_analy_cat5").prop("checked", true) ; }
    if ( data_det.sub_analy_cat6 == 4 ) { $("#sub_analy_cat6").prop("checked", true) ; }
    if ( data_det.sub_analy_cat7 == 4 ) { $("#sub_analy_cat7").prop("checked", true) ; }
    if ( data_det.sub_analy_cat8 == 4 ) { $("#sub_analy_cat8").prop("checked", true) ; }
    if ( data_det.sub_analy_cat9 == 4 ) { $("#sub_analy_cat9").prop("checked", true) ; }
    if ( data_det.sub_analy_cat10 == 4 ){ $("#sub_analy_cat10").prop("checked", true); }

    if ( data_det.sub_postana_cat1 == 4 ) { $("#sub_postana_cat1").prop("checked", true) ; }
    if ( data_det.sub_postana_cat2 == 4 ) { $("#sub_postana_cat2").prop("checked", true) ; }
    if ( data_det.sub_postana_cat3 == 4 ) { $("#sub_postana_cat3").prop("checked", true) ; }
    if ( data_det.sub_postana_cat4 == 4 ) { $("#sub_postana_cat4").prop("checked", true) ; }
    if ( data_det.sub_postana_cat5 == 4 ) { $("#sub_postana_cat5").prop("checked", true) ; }
    if ( data_det.sub_postana_cat6 == 4 ) { $("#sub_postana_cat6").prop("checked", true) ; }
    if ( data_det.sub_postana_cat7 == 4 ) { $("#sub_postana_cat7").prop("checked", true) ; }
    if ( data_det.sub_postana_cat8 == 4 ) { $("#sub_postana_cat8").prop("checked", true) ; }
    if ( data_det.sub_postana_cat9 == 4 ) { $("#sub_postana_cat9").prop("checked", true) ; }

    if ( data_det.sub_res_cat1 == 4 ) { $("#sub_res_cat1").prop("checked", true) ; }
    if ( data_det.sub_res_cat2 == 4 ) { $("#sub_res_cat2").prop("checked", true) ; }
    if ( data_det.sub_res_cat3 == 4 ) { $("#sub_res_cat3").prop("checked", true) ; }
    if ( data_det.sub_res_cat4 == 4 ) { $("#sub_res_cat4").prop("checked", true) ; }
    if ( data_det.sub_res_cat5 == 4 ) { $("#sub_res_cat5").prop("checked", true) ; }
    if ( data_det.sub_res_cat6 == 4 ) { $("#sub_res_cat6").prop("checked", true) ; }

    if ( data_det.sub_hr_cat1 == 4 ) { $("#sub_hr_cat1").prop("checked", true) ; }
    if ( data_det.sub_hr_cat2 == 4 ) { $("#sub_hr_cat2").prop("checked", true) ; }
    if ( data_det.sub_hr_cat3 == 4 ) { $("#sub_hr_cat3").prop("checked", true) ; }
    if ( data_det.sub_hr_cat4 == 4 ) { $("#sub_hr_cat4").prop("checked", true) ; }

    if ( data_det.sub_eqp_cat1 == 4 ) { $("#sub_eqp_cat1").prop("checked", true) ; }
    if ( data_det.sub_eqp_cat2 == 4 ) { $("#sub_eqp_cat2").prop("checked", true) ; }
    if ( data_det.sub_eqp_cat3 == 4 ) { $("#sub_eqp_cat3").prop("checked", true) ; }
    if ( data_det.sub_eqp_cat4 == 4 ) { $("#sub_eqp_cat4").prop("checked", true) ; }
    if ( data_det.sub_eqp_cat5 == 4 ) { $("#sub_eqp_cat5").prop("checked", true) ; }

    if ( data_det.sub_consu_cat1 == 4 ) { $("#sub_consu_cat1").prop("checked", true) ; }
    if ( data_det.sub_consu_cat2 == 4 ) { $("#sub_consu_cat2").prop("checked", true) ; }
    if ( data_det.sub_consu_cat3 == 4 ) { $("#sub_consu_cat3").prop("checked", true) ; }
    if ( data_det.sub_consu_cat4 == 4 ) { $("#sub_consu_cat4").prop("checked", true) ; }
    if ( data_det.sub_consu_cat5 == 4 ) { $("#sub_consu_cat5").prop("checked", true) ; }

    if ( data_det.sub_local_cat1 == 4 ) { $("#sub_local_cat1").prop("checked", true) ; }
    if ( data_det.sub_local_cat2 == 4 ) { $("#sub_local_cat2").prop("checked", true) ; }
    if ( data_det.sub_local_cat3 == 4 ) { $("#sub_local_cat3").prop("checked", true) ; }
    if ( data_det.sub_local_cat4 == 4 ) { $("#sub_local_cat4").prop("checked", true) ; }
    if ( data_det.sub_local_cat5 == 4 ) { $("#sub_local_cat5").prop("checked", true) ; }

    if ( data_det.sub_si_cat1 == 4 ) { $("#sub_si_cat1").prop("checked", true) ; }
    if ( data_det.sub_si_cat2 == 4 ) { $("#sub_si_cat2").prop("checked", true) ; }
    if ( data_det.sub_si_cat3 == 4 ) { $("#sub_si_cat3").prop("checked", true) ; }
    if ( data_det.sub_si_cat4 == 4 ) { $("#sub_si_cat4").prop("checked", true) ; }
    if ( data_det.sub_si_cat5 == 4 ) { $("#sub_si_cat5").prop("checked", true) ; }

    if ( data_det.sub_contract_cat1 == 4 ) { $("#sub_contract_cat1").prop("checked", true) ; }
    if ( data_det.sub_contract_cat2 == 4 ) { $("#sub_contract_cat2").prop("checked", true) ; }
    if ( data_det.sub_contract_cat3 == 4 ) { $("#sub_contract_cat3").prop("checked", true) ; }
    if ( data_det.sub_contract_cat4 == 4 ) { $("#sub_contract_cat4").prop("checked", true) ; }

    // about_pat_rec
    if ( data_det.about_pat_rec == 4 ) { $("#about_pat_rec_yes").prop("checked", true) ; pat_rec_change( $("#about_pat_rec_yes") ) ; }
}

function replaceUndefined(vl)
{
    if (typeof(vl) === "undefined")
    return 5 ;
    else
    return vl;
}

function cancel()
{
window.history.back() ;
}

$( document ).ready( function()
{
load_data() ;
} ) ;
</script>
{% endblock %}
