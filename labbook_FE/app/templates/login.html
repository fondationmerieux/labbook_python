<html lang="{{ locale }}">
<head>
    <title>{{ _("LabBook") }}</title>
    <meta charset="utf-8">
    <link href="{{ url_for('static', filename='img/favicon.ico') }}" rel="shortcut icon" type="image/x-icon">
    <link href="{{ url_for('static', filename='vendor/css/font-awesome.min.css') }}" media="screen" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='vendor/css/bootstrap.min.css') }}" media="screen, print" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/labbook.css') }}?0" media="screen" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="{{ url_for('static', filename='vendor/js/jquery-3.5.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='vendor/js/bootstrap.min.js') }}"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
</head>

<body>
    <div id="page" class="container">
        <header id="page-header">
            <div class="inner">
                <div id="logo">
                    <h1>
                        <a href="{{ session['server_ext'] }}/{{ session['redirect_name'] }}/">{{ _("LabBook") }}</a>
                    </h1>
                </div>
            </div>
        </header>
        <div id="content">
            <div class="inner">
                <div>
	            <div id="auth_std">
                        <div id="auth_msg" class="alert alert-danger" style="display:none;">{{ _("Identifiant ou mot de passe incorrect.") }}</div>
		        <h2>{{ _("Ouverture de session") }}</h2>
			<form method="post" action="#" id="authentication">
			    <div class="form-group row">
	                        <label for="login" class="form-control-label col-5 text-right align-self-center">{{ _("Identifiant") }}</label>
				<div class="col-7">					
                                    <input type="text" name="login" id="login" value="" class="form-control cnx_trigger">			
                                </div>
			    </div>
			    <div class="form-group row">
			        <label for="password" class="form-control-label col-5 text-right align-self-center">{{ _("Mot de passe") }}</label>
			        <div class="col-7">
			            <input type="password" name="password" id="password" value="" class="form-control cnx_trigger">	
                                </div>
			    </div>
			    <div class="form-group row">
                                <div class="col text-center">
			            <input type="button" onclick="send_login();" id="btn_cnx" value="Connexion" class="btn btn-success cnx_trigger">	
                                </div>
                            </div>
		        </form>
		        <div class="clearfix"></div>
	            </div>
                </div>
            </div>
        </div>
        <footer>
            <div class="version">{{ _("Version") }} : {{ session['version'] }} | <a href="{{ session['server_ext'] }}/{{ session['redirect_name'] }}/contributors">{{ _("Contributeurs") }}</a></div>
        </footer>
    </div>
  
</body>

<script>

function send_login()
{
let login = $("#login").val() ;
let pwd   = $("#password").val() ;

var param = '{ "login":"' + login + '", "pwd":"' + pwd + '"}' ;

    $.ajax( 
    {
        type: "POST",
        url: "{{ session['server_ext'] }}/services/user/access",
        dataType: 'json',
        contentType: "application/json; charset=utf-8",
        data: param,
        success: function(ret_ws)
        {
        $("#auth_msg").css("display", "none");
        console.log("SUCCESS post login") ;
        window.location.href = "{{ session['server_ext'] }}/{{ session['redirect_name'] }}/homepage/" + login ;
        },
        error: function(ret_ws)
        {
        console.log("ERROR post login=" + login) ;
        $("#auth_msg").css("display", "block");
        }
    } ) ;
}

$(".cnx_trigger").keyup( function(event) 
{
    if (event.which == 13)
    {
    event.preventDefault() ;
    $("#btn_cnx").click() ;
    }
} ) ;
</script>
</html>
