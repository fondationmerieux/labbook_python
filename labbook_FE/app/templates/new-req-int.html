{% extends "skeleton.html" %}

{% block head %}
{{ super() }}
    {% block title %}
    <title>Nouvelle demande interne</title>
    {% endblock %}
    <!--<link href="{{ url_for('static', filename='vendor/css/select2.min.css') }}" rel="stylesheet" />-->
    <!--<script src="{{ url_for('static', filename='vendor/js/select2.min.js') }}"></script>-->
    <link href="{{ session['server_ext'] }}/select2.min.css" rel="stylesheet" />
    <script src="{{ session['server_ext'] }}/select2.min.js"></script>
{% endblock %}

{% block content %}
<div id="content">
    <div class="inner">
        <div id="main" style="opacity: 1;">
            <h2 class="page-title form-patient_interne"><span>Demande d'analyses patient hospitalisé</span></h2>

            <form id="form_main" class="vzn-form form-horizontal row">
                <div class="panel panel-1 panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">Chercher un patient</h3>
                    </div>
                    <div class="panel-body ">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="statictext col-lg-3 control-label">
                                    <span>Nom, prénom ou code du patient</span>
                                </div>
                                <div class="field col-lg-4">
                                    <!--<input id="search_patient" class="form-control" style="margin-left: 0px;" type="text" value="" aria-autocomplete="list" aria-expanded="false" autocomplete="off">

                                    <div style="width: 184px; left: 2058.5px; top: 1164px;" aria-hidden="true">
                                        <div>
                                            <ul role="listbox"></ul>
                                        </div>
                                    </div>
                                    <div aria-live="polite" role="status"></div>-->
                                    <select id="search_patient" style="width:300px"></select>
                                </div>
                                <div class="clearfix"></div>
                                <div class="form-group button">
                                    <input type="button" onclick="new_pat();" id="new_patient" class="btn undefined btn-default" value="Nouveau patient">
                                    <input type="button" onclick="return_home();" id="exit" class="btn undefined btn-default" value="Quitter">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div><!-- ferme le corps -->
{% endblock %}

{% block add_script %}
<script>
$("#search_patient").select2(
{
    tokenSeparators: [',', ' '],
    minimumInputLength: 2,
    ajax: {
        url: "{{ session['server_ext'] }}/services/patient/search",
        type: "POST",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        term: $("#search_patient").text(),
        data: function (params) {

            return JSON.stringify({
                term: params.term
            });
        },
        processResults: function (data) {
            return {
                results: $.map(data, function (item) {
                    return {
                        text: item.prenom + ' ' + item.nom + ' [' + item.code + ']',
                        id: item.id_data
                    }
                })
            };
        }
    }
} ) ;

$("#search_patient").on("select2:select", function (e) 
{
  var id_pat = $(e.currentTarget).val();
  window.location.href = "{{ session['server_ext'] }}/labbook_FE/det-req-int/Y/" + id_pat ;
} ) ;

function new_pat() 
{
window.location.href = "{{ session['server_ext'] }}/labbook_FE/det-patient/0";
}

function return_home()
{
window.location.href = "{{ session['server_ext'] }}/sigl/";
}
</script>
{% endblock %}
